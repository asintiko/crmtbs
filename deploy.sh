#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy.sh

SERVER_IP="144.31.17.123"
SERVER_PORT="1122"
SERVER_USER="root"
SERVER_PASSWORD="PiZ3ED3y6GC5"

echo "üî® –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
npm run build:win

if [ $? -ne 0 ]; then
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ"
  exit 1
fi

echo "üì¶ –ü–æ–∏—Å–∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ exe..."
EXE_FILE=$(find release -name "*.exe" -type f | head -n 1)

if [ -z "$EXE_FILE" ]; then
  echo "‚ùå –§–∞–π–ª exe –Ω–µ –Ω–∞–π–¥–µ–Ω"
  exit 1
fi

echo "üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä..."
echo "–§–∞–π–ª: $EXE_FILE"

# –ò—Å–ø–æ–ª—å–∑—É–µ–º scp –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç—Ä–µ–±—É–µ—Ç ssh –∫–ª—é—á –∏–ª–∏ –ø–∞—Ä–æ–ª—å)
# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sftp –∏–ª–∏ rsync
scp -P $SERVER_PORT "$EXE_FILE" ${SERVER_USER}@${SERVER_IP}:/tmp/inventory-desktop.exe

if [ $? -ne 0 ]; then
  echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞"
  echo "üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:"
  echo "   - SSH –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω"
  echo "   - –°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É $SERVER_IP:$SERVER_PORT"
  exit 1
fi

echo "‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä"
echo "üìù –§–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ /tmp/inventory-desktop.exe –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"



